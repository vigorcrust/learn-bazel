# learn-bazel

I try to document my way of figuring out bazel, which might become a tutorial...


## versions

I already worked a few hours with bazel writing this paragraph and looking 
through various documentations I realize that the documentation I found on the 
internet are using sometimes very old versions of bazel. To clear it up for
myself and potential readers I am using **bazel 8.1.1**, so the latest version
as of **March, 2025**.


## install

There are a few tutorials how to install bazel or the bazel version mannager
"bazelisk" and I do it differently depending on the environment I am 
currently working on or use for testing.

I basicaly followed the instructions of 
[Official Bazel Docs](https://bazel.build/install) and 
[Official Bazelisk Docs](https://github.com/bazelbuild/bazelisk?tab=readme-ov-file#installation).

So on MACOSX I useed `brew install bazelisk`, on a fresh Debian I used 
`apt-get install nodejs npm` and installed with `npm install -g @bazel/bazelisk`
on other Linux distros I used the other package manager.

As additional tool, but more for learning & remembering stuff I use 
[just](https://github.com/casey/just?tab=readme-ov-file#packages).


## structure of the repo

Because I want to try out a few things, the root of the repo is not a bazel
project, but more an starting point for multiple bazel projects and the current
documentation.

```
.
├── README.md
├── justfile
└── projects
    ├── 001_bootstrap
    │   └── README.md
    └── ...
```


## projects


### 001_bootstrap

My first project, just to see what the building blocks are.
`WORKSPACE` is an "old" concept of defining a project, so you should define 
it with `MODULE.bazel`. You can use as extension `bzl`, but I don't mind writing
more characters and maybe I change it later.

- name of the module must follow a naming convention: `^[a-z][a-z0-9._-]*[a-z0-9]$`

After running `just learn_001_bootstrap_build`, it warns that no targets are
found, but completes successfully - obviously, because I didn't define anything.

It created a few symlinks:
```
  bazel-001_bootstrap/ -> /.../execroot/_main/
  bazel-bin/ -> /.../execroot/_main/bazel-out/darwin_arm64-fastbuild/bin/
  bazel-out/ -> /.../execroot/_main/bazel-out/
  bazel-testlogs/ -> /.../execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/
```
You also see that I am currently working on an MAC Mx system - not my decision,
privatly I use arch btw.

I added a .gitignore file generated by [toptal](https://www.toptal.com/developers/gitignore/api/bazel)
to ignore the symlinks.

So, now I am setup and I am thing what could be the easiesst thing I can do...
I could just write a file?!

I googled `bazel write file` and I found a module called bazel_skylib which 
provides some helper functions. One of those is `write_file`.

To add the dependency to this project I need to
1. tell bazel the dependency
2. load the rules I need for "building"
3. tell bazel what exactly I want.

I found the [Official Registry of bazel](https://registry.bazel.build/all-modules)
where I searched for the module and it told me to add the line:
```
bazel_dep(name = "bazel_skylib", version = "1.7.1")
```
to the `MODULE.bazel` - so step 1 was done.

Now I needed to load the rules, so I went to the main github page of 
[skylib](https://github.com/bazelbuild/bazel-skylib) and found the documentation
of [write_file](https://github.com/bazelbuild/bazel-skylib/blob/main/docs/write_file_doc.md).
I went through all the arguments and ended up with:
```
write_file(
  name = "write_some_text", 
  out = "hello_world.txt", 
  content = ["Hello World"],
)
```

I am ready now, and execute `bazel build :all`, to build all targets.
And it generated the file:
```
INFO: Analyzed target //:write_some_text (0 packages loaded, 0 targets configured).
INFO: Found 1 target...
Target //:write_some_text up-to-date:
  bazel-bin/hello_world.txt
INFO: Elapsed time: 0.211s, Critical Path: 0.01s
INFO: 1 process: 1 internal.
INFO: Build completed successfully, 1 total action
```

Amazing, it works.


